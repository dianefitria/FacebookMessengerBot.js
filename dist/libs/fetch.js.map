{"version":3,"sources":["../../src/libs/fetch.js"],"names":["fetch","url","opts","resolve","reject","body","json","headers","method","req","request","toLowerCase","query","send","credentials","withCredentials","k","v","set","end","err","res","response","error","status","_method","path","text","Object","defineProperty","value","enumerable","configurable","e","ee","test","JSON","parse","trim"],"mappings":"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","file":"fetch.js","sourcesContent":["import request from \"superagent\";\n\nexport default function fetch(url, opts = {}) {\n  return new Promise((resolve, reject) => {\n    if (typeof opts.body === \"object\" || opts.json) {\n      opts.headers = Object.assign(\n        { \"Content-Type\": \"application/json\" },\n        opts.headers || {}\n      );\n    }\n\n    const method = opts.method || \"get\";\n    let req = request[method.toLowerCase()](url);\n\n    req = req.query(opts.query);\n\n    if (opts.method === \"get\") {\n      req = req.query(opts.body);\n    } else {\n      req = req.send(opts.body);\n    }\n\n    if (opts.credentials) {\n      req = req.withCredentials();\n    }\n\n    if (opts.headers) {\n      for (const [k, v] of Object.entries(opts.headers)) {\n        req = req.set(k, v);\n      }\n    }\n\n    req.end((err, res) => {\n      if (err) {\n        try {\n          if (err.response && err.response.error) {\n            err = err.response.error;\n          } else if (res.error) {\n            err = res.error;\n          }\n\n          const { status, method: _method, path, text } = err;\n\n          Object.defineProperty(err, \"res\", {\n            value: res,\n            enumerable: false,\n            configurable: false\n          });\n          Object.defineProperty(err, \"status\", {\n            value: status,\n            enumerable: false,\n            configurable: false\n          });\n          Object.defineProperty(err, \"method\", {\n            value: _method,\n            enumerable: false,\n            configurable: false\n          });\n          Object.defineProperty(err, \"path\", {\n            value: path,\n            enumerable: false,\n            configurable: false\n          });\n          Object.defineProperty(err, \"text\", {\n            value: text,\n            enumerable: false,\n            configurable: false\n          });\n        } catch (e) {\n          try {\n            Object.defineProperty(err, \"res\", {\n              value: res,\n              enumerable: false,\n              configurable: false\n            });\n          } catch (ee) {\n            // fallback for crappy browsers\n            err.res = res;\n          }\n        }\n\n        reject(err);\n      } else {\n        if (\n          (opts.json || /\\/json/g.test(res.headers[\"Content-Type\"])) &&\n          res.text\n        ) {\n          try {\n            res.body = JSON.parse(res.text.trim());\n          } catch (e) {\n            // ignore\n          }\n        }\n\n        resolve(res);\n      }\n    });\n  });\n}\n"]}